<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>ANBELI — Présentation améliorée</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lucide-static@latest/font/lucide.css">
<style>
:root{--primary:#0a74da;--secondary:#00bfa6;--muted:#f9fafb;--card:#fff;--text:#222}
body{font-family:Inter, Arial, sans-serif;margin:0;background:var(--muted);color:var(--text);scroll-behavior:smooth}
header{background:linear-gradient(90deg,var(--primary),var(--secondary));color:#fff;padding:1rem 1.25rem;display:flex;align-items:center;justify-content:space-between;box-shadow:0 2px 8px rgba(0,0,0,.15)}
.header-brand{display:flex;align-items:center;gap:.75rem;animation:fadeIn .8s ease-in-out}
.logo{width:44px;height:44px;border-radius:50%;background:#fff;color:var(--primary);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1.2rem;box-shadow:0 0 8px rgba(255,255,255,.3)}
nav a{color:rgba(255,255,255,.95);text-decoration:none;margin-left:1.2rem;transition:.3s}
nav a:hover{color:#fff;text-decoration:underline}
.hero{max-width:1200px;margin:2rem auto;padding:1.5rem;display:grid;grid-template-columns:1fr 420px;gap:1.5rem;align-items:center}
.card{background:var(--card);padding:1rem;border-radius:14px;box-shadow:0 6px 18px rgba(10,10,20,.06);transition:transform .2s}
.card:hover{transform:translateY(-3px)}
.hero h1{margin:0 0 .5rem;font-size:2rem;color:var(--primary)}
.features{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-top:1rem}
.feature{padding:1rem;border-radius:10px;background:#fff;border:1px solid #eef;display:flex;flex-direction:column;align-items:center;text-align:center;gap:.5rem}
.feature i{font-size:1.6rem;color:var(--secondary)}
.profiles-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem}
.footer{padding:1rem;background:#0f1724;color:#fff;margin-top:2rem;text-align:center}
.btn{background:var(--primary);color:#fff;padding:.6rem 1rem;border-radius:8px;border:none;cursor:pointer;transition:.3s}
.btn:hover{background:var(--secondary)}
.small{font-size:.9rem;color:#666}
.searchbar{display:flex;gap:.5rem}
.pagination{display:flex;justify-content:center;gap:.5rem;margin-top:1rem}
.page-btn{border:1px solid #ddd;padding:.4rem .8rem;border-radius:6px;background:#fff;cursor:pointer;transition:.3s}
.page-btn.active{background:var(--primary);color:#fff}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@media(max-width:900px){.hero{grid-template-columns:1fr;}.features{grid-template-columns:1fr 1fr}.header-brand h2{display:none}}
</style>
</head>
<body>
<header>
  <div class="header-brand">
    <div class="logo">A</div>
    <div>
      <h2 style="margin:0;font-size:1.1rem">ANBELI</h2>
      <div class="small">Gestion RH & Présentation publique</div>
    </div>
  </div>
  <nav>
    <a href="#profiles"><i class="lucide-users"></i> Profils</a>
    <a href="#dashboard"><i class="lucide-bar-chart-2"></i> Tableau</a>
    <a href="#contact"><i class="lucide-mail"></i> Contact</a>
    <a href="#admin" id="admin-link"><i class="lucide-lock"></i> Connexion</a>
  </nav>
</header>

<main>
  <section class="hero">
    <div>
      <div class="card">
        <h1><i class="lucide-briefcase"></i> Vue publique du système ANBELI</h1>
        <p class="small">Découvrez la vitrine de notre solution RH. Consultez les profils, visualisez des graphiques et contactez-nous. L’administration complète reste sécurisée.</p>
        <div class="features">
          <div class="feature"><i class="lucide-users"></i><strong>Profils publics</strong><div class="small">Liste en lecture seule pour visiteurs.</div></div>
          <div class="feature"><i class="lucide-pie-chart"></i><strong>Statistiques</strong><div class="small">Graphiques dynamiques par rôle & poste.</div></div>
          <div class="feature"><i class="lucide-mail"></i><strong>Contact rapide</strong><div class="small">Formulaire simple et intuitif.</div></div>
        </div>
      </div>

      <div id="profiles" class="card" style="margin-top:1rem">
        <h3><i class="lucide-users"></i> Profils de l'équipe</h3>
        <div class="searchbar" style="margin:.5rem 0">
          <input id="searchPublic" placeholder="Rechercher un nom ou poste" style="flex:1;padding:.6rem;border-radius:8px;border:1px solid #ddd" />
          <button class="btn" onclick="loadPublicProfiles()"><i class="lucide-search"></i> Rechercher</button>
        </div>
        <div id="profiles-list" class="profiles-grid"></div>
        <div class="pagination" id="pagination"></div>
        <p class="small" style="margin-top:.75rem">Les informations sensibles restent masquées.</p>
      </div>
    </div>

    <aside>
      <div class="card">
        <h3><i class="lucide-bar-chart-2"></i> Statistiques</h3>
        <canvas id="chartRoles" style="width:100%;height:220px"></canvas>
      </div>
      <div class="card" style="margin-top:1rem">
        <h4><i class="lucide-mail"></i> Contact</h4>
        <form id="contactForm">
          <input type="text" id="contactName" placeholder="Votre nom" style="width:100%;padding:.5rem;margin:.25rem 0;border-radius:6px;border:1px solid #ddd" />
          <input type="email" id="contactEmail" placeholder="E-mail" style="width:100%;padding:.5rem;margin:.25rem 0;border-radius:6px;border:1px solid #ddd" />
          <textarea id="contactMessage" placeholder="Message" style="width:100%;height:80px;padding:.5rem;border-radius:6px;border:1px solid #ddd"></textarea>
          <button type="button" class="btn" onclick="sendContact()"><i class="lucide-send"></i> Envoyer</button>
        </form>
      </div>
      <div class="card" style="margin-top:1rem;text-align:center">
        <h4><i class="lucide-lock"></i> Administration</h4>
        <button class="btn" id="open-login">Se connecter (Admin)</button>
      </div>
    </aside>
  </section>
</main>

<footer class="footer">© ANBELI — Présentation publique | Backend sécurisé Supabase</footer>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
const supabaseUrl = "https://dfjiosdalckuvhpukkjc.supabase.co";
const supabaseAnonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRmamlvc2RhbGNrdXZocHVra2pjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU4NzM5NjAsImV4cCI6MjA2MTQ0OTk2MH0.IDxxMQl7gB6b9cKtga7JX6Pr2PyLfQjk3Pg8HMVMU_8";
const supabase = createClient(supabaseUrl, supabaseAnonKey);
let publicProfiles=[];let currentPage=1;const perPage=9;const $=id=>document.getElementById(id);
async function loadPublicProfiles(){const q=$('searchPublic').value||'';const{data,error}=await supabase.from('profiles').select('id,full_name,poste,role,affectation,created_at').ilike('full_name',`%${q}%`).order('created_at',{ascending:false});if(error){console.error(error);return;}publicProfiles=data||[];renderPublicProfiles();renderChart();}
function paginateProfiles(page){currentPage=page;renderPublicProfiles();}
function renderPublicProfiles(){const container=$('profiles-list');container.innerHTML='';const start=(currentPage-1)*perPage;const items=publicProfiles.slice(start,start+perPage);if(items.length===0){container.innerHTML='<div class="small">Aucun profil trouvé.</div>';return;}items.forEach(p=>{const el=document.createElement('div');el.className='card';el.innerHTML=`<strong><i class='lucide-user'></i> ${p.full_name}</strong><div class='small'><i class='lucide-briefcase'></i> ${p.poste||''}</div><div class='small'><i class='lucide-shield'></i> ${p.role||''}</div><div class='small'><i class='lucide-map-pin'></i> ${p.affectation||''}</div>`;container.appendChild(el);});renderPagination();}
function renderPagination(){const pages=Math.ceil(publicProfiles.length/perPage);const p=$('pagination');p.innerHTML='';for(let i=1;i<=pages;i++){const b=document.createElement('button');b.className='page-btn'+(i===currentPage?' active':'');b.textContent=i;b.onclick=()=>paginateProfiles(i);p.appendChild(b);}}
function renderChart(){const map={};publicProfiles.forEach(p=>{map[p.role]=(map[p.role]||0)+1;});const labels=Object.keys(map);const values=Object.values(map);const ctx=document.getElementById('chartRoles').getContext('2d');if(window.roleChart)window.roleChart.destroy();window.roleChart=new Chart(ctx,{type:'bar',data:{labels,datasets:[{label:'Nombre par rôle',data:values,borderWidth:1,backgroundColor:'#0a74da'}]},options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}});}
async function sendContact(){const name=$('contactName').value.trim(),email=$('contactEmail').value.trim(),message=$('contactMessage').value.trim();if(!name||!message)return alert('Nom et message requis');const{error}=await supabase.from('contacts').insert([{name,email,message,created_at:new Date().toISOString()}]);if(error){alert('Erreur d\'envoi');}else{alert('Message envoyé !');$('contactForm').reset();}}
$('open-login').addEventListener('click',()=>{window.location.href='DB_ANBELI.html';});
window.addEventListener('load',()=>loadPublicProfiles());
</script>
</body>
</html>
